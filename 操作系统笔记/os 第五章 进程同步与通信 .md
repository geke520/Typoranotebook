### 第五章 进程同步与通信
#### 进程同步与互斥基本概念——少量信息的传递

1. 进程同步：两个进程所表示事件的发生有着某种时序上的关系
   * 多道系统中，由于进程间的资源共享或任务协作执行，使进程间可能存在两种形式的制约关系：
     * 间接制约/互斥关系
     * 直接制约/同步关系
2. 进程互斥：由于各进程要求使用共享资源（变量、文件等），而这些资源需要排他性使用各进程之间竞争这些资源。
#### 临界资源、临界区基本概念

1. 临界资源：一次仅允许一个进程使用的资源称为临界资源，包括：慢速设备，共享的变量、数据结构、缓冲区等.
2. 临界区（互斥区）：进程中访问临界资源的代码段称为临界区（critical section）

#### 同步机制应遵循的原则

* 空闲让进
* 有限等待
* 忙则等待
* 让权等待

#### 信号量机制

* 信号量机制是1965年，由荷兰计算机科学家Dijkstra提出的同步方法
* 信号量（Semaphore）：除初始化外,仅能由同步原语对其进行操作的整型变量
* 同步原语：
* P() →wait() 操作     //P（proheren，测试）
* V() →signal() 操作   //V（verhogen，增加）
* 信号量机制目前已经发展成多种类型，主要有：整型、记录型和信号量集机制
* 按用途，信号量可分为两大类
  * 二元信号量：用作互斥变量，初值为1
  *  一般信号量：用于一般同步，初值为共享资源初始数量

#### 经典同步问题
1. 生产者-消费者问题、信号量解决方案——重点难点掌握
   * 问题
     * 一个包含N个单元的缓冲区，每个单元可存储一个数据项
     * 生产者进程生产数据项放入缓冲区，若无空缓冲区则阻塞
     * 消费者进程从缓冲区取出数据项进行消费从而产生空单元，若包含数据项的缓冲区单元则阻塞
   * 分析
     * 使用互斥信号量mutex用于控制对缓冲区的互斥访问，初始化为1
     * 一般信号量empty和full分别用以表示空缓冲区项和满缓冲区项的个数，初始分别为N和0

2. 读者-写者问题、解决方案
   * 问题
     * 共享的数据集或文件可能在多个进程间被并发访问，因此可能有多个读者和写者对其进行操作
     * 一般要求多个读者可以同时操作，而读者与写者、多个写者之间的操作应互斥
   * 分析
     * 为保证写者进程与其它进程互斥访问共享对象，设置互斥信号量db，初值为1
     * 由于允许有多个读者，为了解当前读者数量，设置读者计数变量readercount，多个读者都对
readercount进行操作，设置对其操作的互斥信号量mutex，初值为1

3. 哲学家进餐问题——引入死锁的问题
   * 死锁：两个或多个进程无限地等待一个事件，而该事件只能由这些等待进程之一来触发，这种互为等待的状态称为死锁
   * 饿死——无限期阻塞
   * 问题
     * 假设有5个哲学家，所有的时间用来吃饭和思考，他们共坐一个圆桌上，每个人坐一把椅子，桌上有5根筷子
     *  当某位哲学家感到饥饿时，他会试图拿桌上的筷子，每次只能拿一根，当同时有一双筷子时，他可以吃饭，吃饱后会放下两根筷子，开始思考
     *  需要在多个进程之间分配多个资源且不会出现死锁和饿死
   * 分析
     * 每根共享的筷子都用一个信号量来表示:semaphore chopstick[i]
     * 当5位哲学家都同时拿起左手边的那根筷子→死锁！
   * 解决方案？
     * 最多只允许4位哲学家上桌
     * 只有两根筷子同时可用时，才允许哲学家拿筷子
     * 非对称解决方法：奇数哲学家先拿左手边的筷子，偶数哲学家先拿起右手边的筷子
4. 管程机制——基本组成、条件变量概念、进程和管程的区别
   * 管程是进程间同步的机制，它保证进程互斥地使用临界资源
     * 管程类型提供了一组由程序员定义的、在管程内互斥的操作，确保==一次只有一个进程在管程内==活动
     * 进程通过管程请求临界资源未满足时，管程将其入等待队列 
   * 管程的组成
     * 局部于管程的共享变量说明{数据结构}
     * 对该数据结构进行操作的一组过程
     * 局部于管程数据的初始化语句
   * 条件变量
     * condition类型的变量condition x, y
     * 每个条件变量都关联了一个队列，包含因该条件而阻塞的进程，对条件变量仅有的操作是wait()、signal()
     * x.wait()表示调用该管程的进程因x条件需要被挂起，直到另一进程调用x.signal()
     * x.signal()表示调用该管程的进程因x条件发生了变化，重新启动一个因为x条件而挂起的进程
     
#### 进程通信——大量信息的传递
   * 共享存储器系统
相互通信的进程共享某些数据结构或是共享存储区，进程之间能够通过这些空间进行通信。根据进程之间共享对象的类型将共享存储器系统分为两种：基于共享数据结构的通信方式、基于共享存储区的通信方式。
   * 消息传递系统——重点难点、掌握
进程发送的消息可以是定长的也可以是变长的。如果只可以发送定长的消息，那么系统层的实现就很简单。然而，这种限制增加了程序设计的难度。另一方面，变长的消息需要更复杂的系统层实现，但是程序设计工作更简单。 
   * 管道机制
管道实际上是一种固定大小的缓冲区，管道对于管道两端的进程而言，就是一个文件，但它不是普通的文件，它不属于某种文件系统，而是自立门户，单独构成一种文件系统，并且只存在于内存中。它类似于通信中半双工信道的进程通信机制，一个管道可以实现双向 的数据传输，而同一个时刻只能最多有一个方向的传输，不能两个方向同时进行。管道的容 量大小通常为内存上的一页，它的大小并不是受磁盘容量大小的限制。当管道满时，进程在 写管道会被阻塞，而当管道空时，进程读管道会被阻塞,不能同时进行双向传输。匿名管道只能单向；命名管道可以双向；管道是内存中的，可以有多个进程对其读；也可以有多个进程写，只不过不能同时写。
